C51 COMPILER V8.05a   TASK                                                                 07/20/2017 16:12:43 PAGE 1   


C51 COMPILER V8.05a, COMPILATION OF MODULE TASK
OBJECT MODULE PLACED IN .\task.obj
COMPILER INVOKED BY: C:\Keil_v5\C51\BIN\C51.EXE ..\SOFTWARE\TASK\task.c LARGE BROWSE DEBUG OBJECTEXTEND PRINT(.\task.lst
                    -) TABS(2) OBJECT(.\task.obj)

line level    source

   1          /************************************************************
   2          * 组织名称：
   3          * 文件名称: K:\单片机相关\电子大赛程序框架\SOFTWARE\TASK\TASK.C
   4          * 作者:
   5          * 版本:
   6          * 日期:     2017/07/06
   7          * 描述:  悬挂运动控制系统基本控制函数
   8          * 历史修改记录:
   9          * <作者> <时间> <版本 > <描述>
  10          *
  11          ***********************************************************/
  12          
  13          #include "task.h"
  14          #include "../COMMON_SOFTWARE/DATA_SCOPE/DataScope_DP.h"
  15          #include "setup.h"
  16          #include "../HARDWARE/BSP/USART1.h"
  17          #include "../HARDWARE/DEVICES/SENSOR/ANGLE/ANGLE.h"
  18          #include <math.h>
  19          
  20          #define  BOARD_HEIGHT  100.0f //板子的高度  ，单位厘米
  21          #define  BOARD_WIDTH   50.0f  //板子的宽度  ，单位厘米
  22          #define  BEARING_DIA   10.0f  //旋转轴承的直径，单位毫米
  23          
  24          
  25          //头文件中的结构体定义
  26          /*
  27          
  28          #define LEFT_STEP_MOTOR   0
  29          #define RIGHT_STEP_MOTOR  1
  30          
  31          #define LEFT_WIRE_LENGTH   0 //左边线长
  32          #define RIGHT_WIRE_LENGTH  1 //右边线长
  33          enum State//状态枚举
  34          {
  35            STOP,RUNNING
  36          };
  37          
  38            typedef struct //坐标结构体
  39          {
  40          
  41             float x;
  42             float y;
  43          
  44          
  45          } Coordinate;
  46          
  47          typedef struct   //长度结构体
  48          {  //
  49          
  50             float Length;
  51          
  52          
  53          } Wire;
  54          static Wire g_StepMotorWireLen[2];  // 电机当前位置记录结构体
C51 COMPILER V8.05a   TASK                                                                 07/20/2017 16:12:43 PAGE 2   

  55          static Coordinate g_TargetCoordinate,g_CurrentCoordinate; // 电机当前位置记录结构体
  56          
  57          //利用上面两个结构体一同再构建一个系统信息结构体
  58          typedef struct
  59          {
  60              Coordinate g_TargetCoordinate;
  61              Coordinate g_CurrentCoordinate;
  62              Wire g_StepMotorWireLen[2];
  63              u8 systemState;
  64          }Info;
  65          
  66          
  67           */
  68          
  69          //************************************
  70          // Method:    isSyetemRunning
  71          // FullName:  isSyetemRunning
  72          // Access:    public 
  73          // Returns:   bit
  74          // Qualifier:
  75          // Parameter: void
  76          //************************************
  77          bit isSyetemRunning(void)
  78          {
  79   1        return g_MotionSystemInfo.systemState == RUNNING;
  80   1      }
  81          //************************************
  82          // Method:    isSystemStop
  83          // FullName:  isSystemStop
  84          // Access:    public 
  85          // Returns:   bit
  86          // Qualifier:
  87          // Parameter: void
  88          //************************************
  89          bit isSystemStop(void)
  90          {
  91   1        return g_MotionSystemInfo.systemState == STOP;
  92   1      }
  93          //************************************
  94          // Method:    startSystem
  95          // FullName:  startSystem
  96          // Access:    public 
  97          // Returns:   bit
  98          // Qualifier:
  99          // Parameter: void
 100          //************************************
 101          bit startSystem(void)
 102          {
 103   1      
 104   1      }
*** WARNING C173 IN LINE 104 OF ..\SOFTWARE\TASK\TASK.C: missing return-expression
 105          //************************************
 106          // Method:    stopSystem
 107          // FullName:  stopSystem
 108          // Access:    public 
 109          // Returns:   bit
 110          // Qualifier:
 111          // Parameter: void
 112          //************************************
 113          bit stopSystem(void)
 114          {
 115   1        g_MotionSystemInfo.systemState = STOP;
C51 COMPILER V8.05a   TASK                                                                 07/20/2017 16:12:43 PAGE 3   

 116   1      }
*** WARNING C173 IN LINE 116 OF ..\SOFTWARE\TASK\TASK.C: missing return-expression
 117          
 118          //************************************
 119          // Method:    setTargetCoordinate
 120          // FullName:  setTargetCoordinate
 121          // Access:    public 
 122          // Returns:   bit
 123          // Qualifier: //设置需要到达的目标坐标
 124          // Parameter: float x
 125          // Parameter: float y
 126          //************************************
 127          bit setTargetCoordinate(float x, float y)
 128          {
 129   1        g_MotionSystemInfo.g_TargetCoordinate.x = x;
 130   1        g_MotionSystemInfo.g_TargetCoordinate.y = y;
 131   1        setWireLength(LEFT_WIRE_LENGTH);
 132   1        setWireLength(RIGHT_WIRE_LENGTH);
 133   1      
 134   1        return 1;
 135   1      
 136   1      }
 137          //************************************
 138          // Method:    getCurrentCoordinate
 139          // FullName:  getCurrentCoordinate
 140          // Access:    public 
 141          // Returns:   Coordinate
 142          // Qualifier: //读取当前坐标，返回一个xy结构体
 143          // Parameter: u8 motor
 144          //************************************
 145          Coordinate getCurrentCoordinate(void)
 146          {
 147   1      
 148   1        return g_MotionSystemInfo.g_CurrentCoordinate;
 149   1      }
 150          
 151          
 152          ///////////////////！以下为私有函数，外部不能调用！///////////////////////////
 153          //************************************
 154          // Method:    setWireLength
 155          // FullName:  setWireLength
 156          // Access:    public 
 157          // Returns:   bit
 158          // Qualifier: //设置a,b的长度
 159          // Parameter: u8 wire
 160          //************************************
 161          static bit setWireLength(u8 wire)
 162          {
 163   1        if (wire)
 164   1        {
 165   2          //a的线长计算
 166   2          g_MotionSystemInfo.g_StepMotorWireLen[wire].Length=sqrt(  pow(g_MotionSystemInfo.g_TargetCoordinate.x,2)  
             -            
 167   2                                         +pow(BOARD_HEIGHT- g_MotionSystemInfo.g_TargetCoordinate.y,2)
 168   2                                        ) ;
 169   2        }
 170   1        else
 171   1        {
 172   2          //b的线长计算
 173   2          g_MotionSystemInfo.g_StepMotorWireLen[wire].Length = sqrt(    pow(BOARD_WIDTH-g_MotionSystemInfo.g_Target
             -Coordinate.x, 2)  
 174   2                                        + pow(BOARD_HEIGHT - g_MotionSystemInfo.g_TargetCoordinate.y, 2)
C51 COMPILER V8.05a   TASK                                                                 07/20/2017 16:12:43 PAGE 4   

 175   2                                         );
 176   2        }
 177   1      }
*** WARNING C173 IN LINE 177 OF ..\SOFTWARE\TASK\TASK.C: missing return-expression
 178          static float getWireLength(u8 wire)
 179          {
 180   1        return g_MotionSystemInfo.g_StepMotorWireLen[wire].Length;
 181   1      }
 182          
 183          
 184          
 185          
 186          
 187          
 188          


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    341    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =     49       9
   PDATA SIZE       =   ----    ----
   DATA SIZE        =   ----    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  3 WARNING(S),  0 ERROR(S)
